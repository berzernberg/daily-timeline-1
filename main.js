/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
*/

var P=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var O=Object.prototype.hasOwnProperty;var Z=(T,o,e)=>o in T?P(T,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):T[o]=e;var V=(T,o)=>{for(var e in o)P(T,e,{get:o[e],enumerable:!0})},W=(T,o,e,t)=>{if(o&&typeof o=="object"||typeof o=="function")for(let i of G(o))!O.call(T,i)&&i!==e&&P(T,i,{get:()=>o[i],enumerable:!(t=B(o,i))||t.enumerable});return T};var X=T=>W(P({},"__esModule",{value:!0}),T);var v=(T,o,e)=>Z(T,typeof o!="symbol"?o+"":o,e);var U={};V(U,{default:()=>N});module.exports=X(U);var z=require("obsidian");var A=require("obsidian");var x=class{static detectOverlaps(o){let e=o.filter(n=>n.isTimeRange),t=o.filter(n=>!n.isTimeRange),i=[];for(let n of e){if(!n.endHour||n.endMinute===void 0)continue;let a=n.hour*60+n.minute,l=n.endHour*60+n.endMinute,r=0;for(let c of t){let m=c.hour*60+c.minute;if(m>=a&&m<=l){r=1;break}}if(r===0)for(let c of e){if(c===n||!c.endHour||c.endMinute===void 0)continue;let m=c.hour*60+c.minute,d=c.endHour*60+c.endMinute;if(this.rangesOverlap(a,l,m,d)){r=1;break}}i.push({task:n,overlapLevel:r})}let s=i.sort((n,a)=>{let l=n.task.hour*60+n.task.minute,r=a.task.hour*60+a.task.minute;return l-r});for(let n=0;n<s.length;n++){let a=s[n];if(a.overlapLevel===0)continue;let l=a.task.hour*60+a.task.minute,r=(a.task.endHour||0)*60+(a.task.endMinute||0),c=0;for(let m=0;m<n;m++){let d=s[m];if(d.overlapLevel===0)continue;let h=d.task.hour*60+d.task.minute,g=(d.task.endHour||0)*60+(d.task.endMinute||0);this.rangesOverlap(l,r,h,g)&&(c=Math.max(c,d.overlapLevel))}a.overlapLevel=c+1}return s}static rangesOverlap(o,e,t,i){return o<i&&t<e}};var C="daily-notes-timeline",b={MIN:.7,MAX:10,DEFAULT:1,STEP:.5,BASE_SEGMENT_WIDTH:200},F=class extends A.ItemView{constructor(e,t){super(e);v(this,"plugin");v(this,"contentEl");v(this,"startDate");v(this,"endDate");v(this,"tooltips",[]);v(this,"zoomLevel",b.DEFAULT);v(this,"timelineScrollEl",null);v(this,"timelineContainerEl",null);v(this,"isDragging",!1);v(this,"dragStartX",0);v(this,"dragStartScrollLeft",0);v(this,"viewMode","month");v(this,"monthSelectEl",null);v(this,"quickRangeSelectEl",null);v(this,"startDateInputEl",null);v(this,"endDateInputEl",null);v(this,"customRangeContainerEl",null);v(this,"zoomSlider",null);v(this,"zoomLabel",null);this.plugin=t,this.viewMode=this.plugin.settings.viewMode;let i=new Date;this.viewMode==="custom"&&this.plugin.settings.customStartDate&&this.plugin.settings.customEndDate?(this.startDate=this.parseStoredDate(this.plugin.settings.customStartDate),this.endDate=this.parseStoredDate(this.plugin.settings.customEndDate)):(this.startDate=new Date(i.getFullYear(),i.getMonth(),1),this.endDate=new Date(i.getFullYear(),i.getMonth()+1,0))}parseStoredDate(e){let[t,i,s]=e.split("-").map(Number);return new Date(t,i-1,s)}formatDateForStorage(e){let t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${i}-${s}`}formatDateForInput(e){return this.formatDateForStorage(e)}getRangeDurationInDays(){let e=Math.abs(this.endDate.getTime()-this.startDate.getTime());return Math.ceil(e/(1e3*60*60*24))+1}getViewType(){return C}getDisplayText(){return"Daily Notes Timeline"}getIcon(){return"calendar-clock"}async onOpen(){let e=this.containerEl.children[1];e.empty(),e.addClass("timeline-view-container"),this.contentEl=e.createDiv({cls:"timeline-content"}),await this.renderControls(),await this.renderTimeline()}async onClose(){this.cleanupTooltips(),this.contentEl.empty()}cleanupTooltips(){for(let e of this.tooltips)e.remove();this.tooltips=[]}async renderControls(){let e=this.contentEl.createDiv({cls:"timeline-controls"}),t=e.createDiv({cls:"timeline-controls-left"}),i=e.createDiv({cls:"timeline-controls-center"}),s=e.createDiv({cls:"timeline-controls-right"});this.renderModeSelector(s),this.renderMonthControls(s),this.renderCustomRangeControls(s),this.updateControlsVisibility(),t.createEl("button",{text:"\u2190 Previous",cls:"mod-cta"}).addEventListener("click",async()=>{await this.navigatePrevious()}),t.createEl("button",{text:"Next \u2192",cls:"mod-cta"}).addEventListener("click",async()=>{await this.navigateNext()}),t.createEl("button",{text:"Today",cls:"mod-cta"}).addEventListener("click",async()=>{await this.navigateToToday()}),this.renderZoomControls(i)}renderModeSelector(e){let i=e.createDiv({cls:"timeline-mode-selector"}).createEl("select",{cls:"dropdown timeline-mode-select"}),s=i.createEl("option",{value:"month",text:"Month View"}),n=i.createEl("option",{value:"custom",text:"Custom Range"});i.value=this.viewMode,i.addEventListener("change",async()=>{if(this.viewMode=i.value,this.plugin.settings.viewMode=this.viewMode,await this.plugin.saveSettings(),this.updateControlsVisibility(),this.viewMode==="month"){let a=new Date;this.startDate=new Date(a.getFullYear(),a.getMonth(),1),this.endDate=new Date(a.getFullYear(),a.getMonth()+1,0),this.monthSelectEl&&await this.updateMonthSelect(this.monthSelectEl)}await this.renderTimeline()})}renderMonthControls(e){let i=e.createDiv({cls:"timeline-month-controls"}).createEl("select",{cls:"dropdown timeline-month-select"});this.monthSelectEl=i,this.populateMonthSelect(i),i.addEventListener("change",async()=>{let[s,n]=i.value.split("-").map(Number);this.startDate=new Date(s,n,1),this.endDate=new Date(s,n+1,0),this.zoomLevel=b.DEFAULT,await this.renderTimeline(),this.updateZoomSlider()})}renderCustomRangeControls(e){let t=e.createDiv({cls:"timeline-custom-range-controls"});this.customRangeContainerEl=t;let i=t.createEl("select",{cls:"dropdown timeline-quick-range-select"});this.quickRangeSelectEl=i,[{value:"last7days",label:"Last 7 Days"},{value:"last30days",label:"Last 30 Days"},{value:"thisweek",label:"This Week"},{value:"thismonth",label:"This Month"},{value:"last3months",label:"Last 3 Months"},{value:"custom",label:"Custom"}].forEach(m=>{i.createEl("option",{value:m.value,text:m.label})}),i.value=this.plugin.settings.lastQuickRangePreset,i.addEventListener("change",async()=>{let m=i.value;this.plugin.settings.lastQuickRangePreset=m,await this.plugin.saveSettings(),m!=="custom"&&this.applyQuickRangePreset(m)});let n=t.createDiv({cls:"timeline-date-inputs"}),a=n.createSpan({cls:"timeline-date-label",text:"From:"}),l=n.createEl("input",{type:"date",cls:"timeline-date-input"});this.startDateInputEl=l,l.value=this.formatDateForInput(this.startDate);let r=n.createSpan({cls:"timeline-date-label",text:"To:"}),c=n.createEl("input",{type:"date",cls:"timeline-date-input"});this.endDateInputEl=c,c.value=this.formatDateForInput(this.endDate),l.addEventListener("change",async()=>{await this.handleCustomDateChange()}),c.addEventListener("change",async()=>{await this.handleCustomDateChange()})}async handleCustomDateChange(){if(!this.startDateInputEl||!this.endDateInputEl)return;let e=this.startDateInputEl.value,t=this.endDateInputEl.value;if(!e||!t)return;let i=new Date(e),s=new Date(t);if(s<i){alert("End date must be after or equal to start date"),this.startDateInputEl.value=this.formatDateForInput(this.startDate),this.endDateInputEl.value=this.formatDateForInput(this.endDate);return}if(Math.ceil((s.getTime()-i.getTime())/(1e3*60*60*24))>365){alert("Date range cannot exceed 365 days"),this.startDateInputEl.value=this.formatDateForInput(this.startDate),this.endDateInputEl.value=this.formatDateForInput(this.endDate);return}this.startDate=i,this.endDate=s,this.plugin.settings.customStartDate=this.formatDateForStorage(this.startDate),this.plugin.settings.customEndDate=this.formatDateForStorage(this.endDate),await this.plugin.saveSettings(),this.quickRangeSelectEl&&(this.quickRangeSelectEl.value="custom",this.plugin.settings.lastQuickRangePreset="custom",await this.plugin.saveSettings()),this.zoomLevel=b.DEFAULT,await this.renderTimeline(),this.updateZoomSlider()}applyQuickRangePreset(e){let t=new Date;switch(t.setHours(0,0,0,0),e){case"last7days":this.endDate=new Date(t),this.startDate=new Date(t),this.startDate.setDate(this.startDate.getDate()-6);break;case"last30days":this.endDate=new Date(t),this.startDate=new Date(t),this.startDate.setDate(this.startDate.getDate()-29);break;case"thisweek":let i=t.getDay();this.startDate=new Date(t),this.startDate.setDate(this.startDate.getDate()-i),this.endDate=new Date(this.startDate),this.endDate.setDate(this.endDate.getDate()+6);break;case"thismonth":this.startDate=new Date(t.getFullYear(),t.getMonth(),1),this.endDate=new Date(t.getFullYear(),t.getMonth()+1,0);break;case"last3months":this.endDate=new Date(t),this.startDate=new Date(t),this.startDate.setMonth(this.startDate.getMonth()-3);break}this.startDateInputEl&&this.endDateInputEl&&(this.startDateInputEl.value=this.formatDateForInput(this.startDate),this.endDateInputEl.value=this.formatDateForInput(this.endDate)),this.plugin.settings.customStartDate=this.formatDateForStorage(this.startDate),this.plugin.settings.customEndDate=this.formatDateForStorage(this.endDate),this.plugin.saveSettings(),this.zoomLevel=b.DEFAULT,this.renderTimeline(),this.updateZoomSlider()}updateControlsVisibility(){this.monthSelectEl&&this.monthSelectEl.parentElement&&(this.viewMode==="month"?this.monthSelectEl.parentElement.style.display="":this.monthSelectEl.parentElement.style.display="none"),this.customRangeContainerEl&&(this.viewMode==="custom"?this.customRangeContainerEl.style.display="":this.customRangeContainerEl.style.display="none")}async navigatePrevious(){if(this.viewMode==="month")this.startDate=new Date(this.startDate.getFullYear(),this.startDate.getMonth()-1,1),this.endDate=new Date(this.endDate.getFullYear(),this.endDate.getMonth(),0),this.monthSelectEl&&await this.updateMonthSelect(this.monthSelectEl);else{let e=this.getRangeDurationInDays();this.startDate.setDate(this.startDate.getDate()-e),this.endDate.setDate(this.endDate.getDate()-e),this.startDateInputEl&&this.endDateInputEl&&(this.startDateInputEl.value=this.formatDateForInput(this.startDate),this.endDateInputEl.value=this.formatDateForInput(this.endDate)),this.plugin.settings.customStartDate=this.formatDateForStorage(this.startDate),this.plugin.settings.customEndDate=this.formatDateForStorage(this.endDate),await this.plugin.saveSettings(),this.quickRangeSelectEl&&(this.quickRangeSelectEl.value="custom")}this.zoomLevel=b.DEFAULT,await this.renderTimeline(),this.updateZoomSlider()}async navigateNext(){if(this.viewMode==="month")this.startDate=new Date(this.startDate.getFullYear(),this.startDate.getMonth()+1,1),this.endDate=new Date(this.endDate.getFullYear(),this.endDate.getMonth()+2,0),this.monthSelectEl&&await this.updateMonthSelect(this.monthSelectEl);else{let e=this.getRangeDurationInDays();this.startDate.setDate(this.startDate.getDate()+e),this.endDate.setDate(this.endDate.getDate()+e),this.startDateInputEl&&this.endDateInputEl&&(this.startDateInputEl.value=this.formatDateForInput(this.startDate),this.endDateInputEl.value=this.formatDateForInput(this.endDate)),this.plugin.settings.customStartDate=this.formatDateForStorage(this.startDate),this.plugin.settings.customEndDate=this.formatDateForStorage(this.endDate),await this.plugin.saveSettings(),this.quickRangeSelectEl&&(this.quickRangeSelectEl.value="custom")}this.zoomLevel=b.DEFAULT,await this.renderTimeline(),this.updateZoomSlider()}async navigateToToday(){this.viewMode="month",this.plugin.settings.viewMode="month",await this.plugin.saveSettings();let e=new Date;this.startDate=new Date(e.getFullYear(),e.getMonth(),1),this.endDate=new Date(e.getFullYear(),e.getMonth()+1,0),this.updateControlsVisibility(),this.monthSelectEl&&await this.updateMonthSelect(this.monthSelectEl);let t=this.contentEl.querySelector(".timeline-mode-select");t&&(t.value="month"),this.zoomLevel=b.DEFAULT,await this.renderTimeline(),this.updateZoomSlider()}renderZoomControls(e){let t=e.createDiv({cls:"timeline-zoom-controls"}),i=t.createEl("button",{cls:"timeline-zoom-button",attr:{"aria-label":"Zoom out"}});i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path><line x1="8" y1="11" x2="14" y2="11"></line></svg>',i.addEventListener("click",()=>{let r=Math.max(b.MIN,this.zoomLevel-b.STEP);this.applyZoom(r)});let s=t.createDiv({cls:"timeline-zoom-slider-container"}),n=s.createEl("input",{type:"range",cls:"timeline-zoom-slider"});n.min=String(b.MIN*100),n.max=String(b.MAX*100),n.value=String(this.zoomLevel*100),n.step=String(b.STEP*100);let a=s.createDiv({cls:"timeline-zoom-label"});a.setText(`${Math.round(this.zoomLevel*100)}%`);let l=t.createEl("button",{cls:"timeline-zoom-button",attr:{"aria-label":"Zoom in"}});l.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path><line x1="11" y1="8" x2="11" y2="14"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>',l.addEventListener("click",()=>{let r=Math.min(b.MAX,this.zoomLevel+b.STEP);this.applyZoom(r)}),n.addEventListener("input",()=>{let r=parseFloat(n.value)/100;a.setText(`${Math.round(r*100)}%`)}),n.addEventListener("change",()=>{let r=parseFloat(n.value)/100;this.applyZoom(r)}),this.zoomSlider=n,this.zoomLabel=a}updateZoomSlider(){this.zoomSlider&&(this.zoomSlider.value=String(this.zoomLevel*100)),this.zoomLabel&&this.zoomLabel.setText(`${Math.round(this.zoomLevel*100)}%`)}applyZoom(e,t){if(!this.timelineContainerEl)return;let i=this.timelineContainerEl,s=i.scrollLeft,n=i.clientWidth,a=i.scrollWidth,l;t!==void 0?l=s+t:l=s+n/2;let r=l/a;this.zoomLevel=e,this.updateZoomSlider(),this.renderTimeline().then(()=>{if(!this.timelineContainerEl)return;let c=this.timelineContainerEl.scrollWidth,m=r*c,d=t!==void 0?m-t:m-n/2;this.timelineContainerEl.scrollLeft=Math.max(0,d)})}setupTimelineInteractions(e){e.addEventListener("wheel",s=>{if(s.ctrlKey||s.metaKey){s.preventDefault();let n=e.getBoundingClientRect(),a=s.clientX-n.left,r=-s.deltaY>0?b.STEP:-b.STEP,c=Math.max(b.MIN,Math.min(b.MAX,this.zoomLevel+r));this.applyZoom(c,a)}else s.preventDefault(),e.scrollLeft+=s.deltaY}),e.addEventListener("mousedown",s=>{if(s.button!==0)return;let n=s.target;n.closest(".timeline-task")||n.closest("a")||(s.preventDefault(),this.isDragging=!0,this.dragStartX=s.clientX,this.dragStartScrollLeft=e.scrollLeft,e.style.cursor="grabbing",e.style.userSelect="none")});let t=s=>{if(!this.isDragging||!this.timelineContainerEl)return;s.preventDefault();let n=s.clientX-this.dragStartX;this.timelineContainerEl.scrollLeft=this.dragStartScrollLeft-n},i=()=>{this.isDragging&&this.timelineContainerEl&&(this.isDragging=!1,this.timelineContainerEl.style.cursor="grab",this.timelineContainerEl.style.userSelect="")};document.addEventListener("mousemove",t),document.addEventListener("mouseup",i),e.addEventListener("mouseleave",()=>{this.isDragging&&this.timelineContainerEl&&(this.isDragging=!1,this.timelineContainerEl.style.cursor="grab",this.timelineContainerEl.style.userSelect="")})}async populateMonthSelect(e){let t=await this.plugin.parser.getAvailableMonths(this.plugin.settings.dailyNotesFolder,this.plugin.settings.dateFormat);e.empty();for(let i of t){let[s,n]=i.split("-").map(Number),a=new Date(s,n,1),l=e.createEl("option");l.value=i,l.text=a.toLocaleDateString("en-US",{year:"numeric",month:"long"}),s===this.startDate.getFullYear()&&n===this.startDate.getMonth()&&(l.selected=!0)}}async updateMonthSelect(e){e.value=`${this.startDate.getFullYear()}-${this.startDate.getMonth()}`}async renderTimeline(){this.cleanupTooltips();let e=this.contentEl.querySelector(".timeline-scroll");e&&e.remove();let t=this.contentEl.createDiv({cls:"timeline-scroll"});this.timelineScrollEl=t;let i=await this.plugin.parser.parseDailyNotes(this.plugin.settings.dailyNotesFolder,this.plugin.settings.dateFormat,this.startDate,this.endDate);if(i.length===0){t.createDiv({cls:"timeline-empty",text:"No date range selected"});return}await this.renderContinuousTimeline(t,i)}async renderContinuousTimeline(e,t){let i=e.createDiv({cls:"timeline-continuous"});this.timelineContainerEl=i,this.setupTimelineInteractions(i);let s=i.createDiv({cls:"timeline-track-continuous"}),n=b.BASE_SEGMENT_WIDTH*this.zoomLevel,a=n*t.length;s.style.width=`${a}px`;for(let l=0;l<t.length;l++){let r=t[l];await this.renderDaySegment(s,r,l,t.length,n)}}groupOverlappingTasks(e,t){if(e.length===0)return[];if(!this.plugin.settings.enableGrouping)return e;let s=[...e.filter(c=>!c.isTimeRange)].sort((c,m)=>{let d=c.hour*60+c.minute,h=m.hour*60+m.minute;return d-h}),n=this.plugin.settings.minSpacingPixels,a=this.plugin.settings.maxGroupSpanPixels,l=[],r=[s[0]];for(let c=1;c<s.length;c++){let m=s[c-1],d=s[c],h=(m.hour*60+m.minute)/1440*100,g=(d.hour*60+d.minute)/1440*100,u=Math.abs(g-h)*(t/100),p=(r[0].hour*60+r[0].minute)/1440*100,D=Math.abs(g-p)*(t/100);if(u<n&&D<a)r.push(d);else{if(r.length>1){let f=r.reduce((L,M)=>L+(M.hour*60+M.minute),0)/r.length,E=f/1440*100,y=Math.floor(f/60),w=Math.floor(f%60);l.push({tasks:r,position:E,averageTime:`${String(y).padStart(2,"0")}:${String(w).padStart(2,"0")}`})}else l.push(r[0]);r=[d]}}if(r.length>1){let c=r.reduce((g,u)=>g+(u.hour*60+u.minute),0)/r.length,m=c/1440*100,d=Math.floor(c/60),h=Math.floor(c%60);l.push({tasks:r,position:m,averageTime:`${String(d).padStart(2,"0")}:${String(h).padStart(2,"0")}`})}else l.push(r[0]);return l}async renderDaySegment(e,t,i,s,n){let a=e.createDiv({cls:"timeline-segment"});a.style.width=`${n}px`,a.style.left=`${n*i}px`,t.tasks.length===0&&a.addClass("timeline-segment-empty");let l=new Date(t.date),r=a.createDiv({cls:"timeline-segment-date"});r.setText(l.toLocaleDateString("en-US",{month:"short",day:"numeric"})),t.path&&(r.addClass("timeline-segment-date-clickable"),r.addEventListener("click",async u=>{u.preventDefault();let p=this.app.vault.getAbstractFileByPath(t.path);p&&await this.app.workspace.getLeaf(!1).openFile(p)})),a.createDiv({cls:"timeline-segment-weekday"}).setText(l.toLocaleDateString("en-US",{weekday:"short"})),a.createDiv({cls:"timeline-segment-time timeline-segment-time-start"}).setText("00:00"),a.createDiv({cls:"timeline-segment-time timeline-segment-time-end"}).setText("23:59");let h=this.groupOverlappingTasks(t.tasks,n);for(let u of h)"tasks"in u?await this.renderGroupedTaskInSegment(a,u):await this.renderTaskInSegment(a,u);let g=x.detectOverlaps(t.tasks);for(let u of g)await this.renderTimeRangeInSegment(a,u)}getTagStyle(e){return e?this.plugin.settings.tagStyles.find(t=>t.tag===e):null}async renderGroupedTaskInSegment(e,t){let i=e.createDiv({cls:"timeline-task-dot-container timeline-task-grouped"}),s=Math.min(t.position,96);i.style.left=`${s}%`;let n=i.createDiv({cls:"timeline-task-dot"});n.setAttribute("data-status","grouped"),n.createDiv({cls:"timeline-task-count-badge"}).setText(String(t.tasks.length));let l=i.createDiv({cls:"timeline-emoji-stack"}),r=new Set;for(let d of t.tasks){let h=this.getTagStyle(d.firstTag);h&&h.emoji?r.add(h.emoji):d.hasAttachment&&!r.has("\u{1F4F8}")&&r.add("\u{1F4F8}")}r.forEach(d=>{l.createDiv({cls:"timeline-task-emoji"}).setText(d)});let c=document.body.createDiv({cls:"timeline-tooltip"});this.tooltips.push(c);let m=c.createDiv({cls:"timeline-tooltip-wrapper"});for(let d=0;d<t.tasks.length;d++){let h=t.tasks[d],g=m.createDiv({cls:"timeline-tooltip-content"});d>0&&g.addClass("timeline-tooltip-stacked");let u=g.createDiv({cls:"timeline-tooltip-time"}),p=this.getTagStyle(h.firstTag);p&&p.emoji&&u.createSpan({cls:"timeline-tooltip-time-emoji"}).setText(p.emoji),u.createSpan().setText(h.time);let f=g.createDiv({cls:"timeline-tooltip-task"});if(f.textContent=`[${h.status}] `,await this.renderTaskContent(f,h.content),h.subItems.length>0){let E=g.createEl("ul",{cls:"timeline-tooltip-subitems"});for(let y of h.subItems){let w=E.createEl("li");await this.renderTaskContent(w,y)}}}i.addEventListener("mouseenter",()=>{let d=i.getBoundingClientRect(),h=window.innerHeight,g=t.tasks.length*120,u=d.bottom+12,p=d.left+d.width/2,D="translateX(-50%)",f=!1;u+g>h-20&&h-u-20<200&&(u=d.top-Math.min(g,h*.6)-12,f=!0,u<20&&(u=20));let E=Math.min(h*.7,g);m.style.maxHeight=`${E}px`,f?c.addClass("tooltip-above"):c.removeClass("tooltip-above"),c.style.top=`${u}px`,c.style.left=`${p}px`,c.style.transform=D,c.addClass("is-visible"),i.addClass("is-hovered")}),i.addEventListener("mouseleave",()=>{c.removeClass("is-visible"),c.removeClass("tooltip-above"),i.removeClass("is-hovered")}),c.addEventListener("mouseenter",()=>{c.addClass("is-visible"),i.addClass("is-hovered")}),c.addEventListener("mouseleave",()=>{c.removeClass("is-visible"),c.removeClass("tooltip-above"),i.removeClass("is-hovered")})}async renderTaskInSegment(e,t){let s=(t.hour*60+t.minute)/1440*100;s=Math.min(s,96);let n=e.createDiv({cls:"timeline-task-dot-container"});n.style.left=`${s}%`;let a=n.createDiv({cls:"timeline-task-dot"});a.setAttribute("data-status",t.status);let l=this.getTagStyle(t.firstTag);l&&l.color&&(a.addClass("timeline-task-dot-custom"),a.style.setProperty("background-color",l.color,"important")),a.createDiv({cls:"timeline-task-label"}).setText(t.time);let c=n.createDiv({cls:"timeline-emoji-stack"});l&&l.emoji?c.createDiv({cls:"timeline-task-emoji"}).setText(l.emoji):t.hasAttachment&&c.createDiv({cls:"timeline-task-emoji"}).setText("\u{1F4F8}");let m=document.body.createDiv({cls:"timeline-tooltip"});this.tooltips.push(m);let d=m.createDiv({cls:"timeline-tooltip-content"}),h=d.createDiv({cls:"timeline-tooltip-time"});l&&l.emoji&&h.createSpan({cls:"timeline-tooltip-time-emoji"}).setText(l.emoji),h.createSpan().setText(t.time);let u=d.createDiv({cls:"timeline-tooltip-task"});if(u.textContent=`[${t.status}] `,await this.renderTaskContent(u,t.content),t.subItems.length>0){let p=d.createEl("ul",{cls:"timeline-tooltip-subitems"});for(let D of t.subItems){let f=p.createEl("li");await this.renderTaskContent(f,D)}}n.addEventListener("mouseenter",()=>{let p=n.getBoundingClientRect(),D=window.innerHeight,f=p.bottom+12;setTimeout(()=>{let E=m.offsetHeight;f+E>D-20?(f=p.top-E-12,m.addClass("tooltip-above"),f<20&&(f=20)):m.removeClass("tooltip-above"),m.style.top=`${f}px`},0),m.style.top=`${f}px`,m.style.left=`${p.left+p.width/2}px`,m.style.transform="translateX(-50%)",m.addClass("is-visible"),n.addClass("is-hovered")}),n.addEventListener("mouseleave",()=>{m.removeClass("is-visible"),m.removeClass("tooltip-above"),n.removeClass("is-hovered")}),m.addEventListener("mouseenter",()=>{m.addClass("is-visible"),n.addClass("is-hovered")}),m.addEventListener("mouseleave",()=>{m.removeClass("is-visible"),m.removeClass("tooltip-above"),n.removeClass("is-hovered")})}async renderTaskContent(e,t){let i=/(!\[\[([^\]]+)\]\])|(\[\[([^\]]+)\]\])/g,s=0,n;for(;(n=i.exec(t))!==null;){if(n.index>s&&await this.renderTextWithLinks(e,t.substring(s,n.index)),n[1]){let a=n[2];await this.renderImage(e,a)}else if(n[3]){let a=n[4];this.renderLink(e,a)}s=n.index+n[0].length}s<t.length&&await this.renderTextWithLinks(e,t.substring(s))}async renderTextWithLinks(e,t){let i=/#([\p{L}\p{N}_\/-]+)/gu,s=0,n;for(;(n=i.exec(t))!==null;){if(n.index>s){let r=e.createSpan();r.textContent=t.substring(s,n.index)}let a=n[1],l=e.createEl("a",{cls:"tag timeline-tooltip-tag",href:"#"});l.textContent=`#${a}`,l.addEventListener("click",async r=>{var c;r.preventDefault(),(c=this.app.internalPlugins.getPluginById("global-search"))==null||c.instance.openGlobalSearch(`tag:#${a}`)}),s=n.index+n[0].length}if(s<t.length){let a=e.createSpan();a.textContent=t.substring(s)}}renderLink(e,t){let i=t.split("|"),s=i[0].trim(),n=i.length>1?i[1].trim():s,a=e.createEl("a",{cls:"internal-link timeline-tooltip-link",href:"#"});a.textContent=n,a.addEventListener("click",async l=>{l.preventDefault();let r=this.plugin.app.metadataCache.getFirstLinkpathDest(s,"");r&&await this.plugin.app.workspace.getLeaf(!1).openFile(r)})}async renderTimeRangeInSegment(e,t){let i=t.task;if(!i.endHour||i.endMinute===void 0)return;let s=i.hour*60+i.minute,n=i.endHour*60+i.endMinute,a=Math.min(s/1440*100,96),r=Math.min(n/1440*100,100)-a,c=e.createDiv({cls:"timeline-range-container"});c.style.left=`${a}%`,c.style.width=`${r}%`;let m=t.overlapLevel===0?0:t.overlapLevel*40;c.style.bottom=`calc(50% + ${m}px)`,c.setAttribute("data-overlap-level",String(t.overlapLevel));let d=c.createDiv({cls:"timeline-range-line"});d.setAttribute("data-status",i.status);let h=this.getTagStyle(i.firstTag);h&&h.color&&(d.addClass("timeline-range-line-custom"),d.style.setProperty("background-color",h.color,"important")),d.createDiv({cls:"timeline-range-label"}).setText(`${i.time} - ${i.timeEnd}`);let u=c.createDiv({cls:"timeline-range-emoji"});h&&h.emoji?u.createDiv({cls:"timeline-task-emoji"}).setText(h.emoji):i.hasAttachment&&u.createDiv({cls:"timeline-task-emoji"}).setText("\u{1F4F8}");let p=document.body.createDiv({cls:"timeline-tooltip"});this.tooltips.push(p);let D=p.createDiv({cls:"timeline-tooltip-content"}),f=D.createDiv({cls:"timeline-tooltip-time"});h&&h.emoji&&f.createSpan({cls:"timeline-tooltip-time-emoji"}).setText(h.emoji),f.createSpan().setText(`${i.time} - ${i.timeEnd}`);let y=D.createDiv({cls:"timeline-tooltip-task"});if(y.textContent=`[${i.status}] `,await this.renderTaskContent(y,i.content),i.subItems.length>0){let w=D.createEl("ul",{cls:"timeline-tooltip-subitems"});for(let L of i.subItems){let M=w.createEl("li");await this.renderTaskContent(M,L)}}c.addEventListener("mouseenter",()=>{let w=c.getBoundingClientRect(),L=window.innerHeight,M=w.bottom+12;setTimeout(()=>{let $=p.offsetHeight;M+$>L-20?(M=w.top-$-12,p.addClass("tooltip-above"),M<20&&(M=20)):p.removeClass("tooltip-above"),p.style.top=`${M}px`},0),p.style.top=`${M}px`,p.style.left=`${w.left+w.width/2}px`,p.style.transform="translateX(-50%)",p.addClass("is-visible"),c.addClass("is-hovered")}),c.addEventListener("mouseleave",()=>{p.removeClass("is-visible"),p.removeClass("tooltip-above"),c.removeClass("is-hovered")}),p.addEventListener("mouseenter",()=>{p.addClass("is-visible"),c.addClass("is-hovered")}),p.addEventListener("mouseleave",()=>{p.removeClass("is-visible"),p.removeClass("tooltip-above"),c.removeClass("is-hovered")})}async renderImage(e,t){let i=this.plugin.app.vault.getAbstractFileByPath(t);if(i&&i instanceof this.plugin.app.vault.adapter.constructor){let n=e.createDiv({cls:"timeline-tooltip-image"}).createEl("img"),a=this.plugin.app.vault.getResourcePath(i);n.src=a,n.alt=t}else{let n=this.plugin.app.vault.getFiles().find(a=>a.name===t||a.path.endsWith(t));if(n){let l=e.createDiv({cls:"timeline-tooltip-image"}).createEl("img"),r=this.plugin.app.vault.getResourcePath(n);l.src=r,l.alt=t}}}};var k=require("obsidian");var H=class extends k.PluginSettingTab{constructor(e,t){super(e,t);v(this,"plugin");this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"Daily Notes Timeline Settings"}),new k.Setting(e).setName("Daily Notes Folder").setDesc("Path to your daily notes folder (leave empty for vault root or default daily notes location)").addText(t=>t.setPlaceholder("Daily Notes").setValue(this.plugin.settings.dailyNotesFolder).onChange(async i=>{this.plugin.settings.dailyNotesFolder=i,await this.plugin.saveSettings()})),new k.Setting(e).setName("Date Format").setDesc("Format used in daily note filenames (e.g., YYYY-MM-DD)").addText(t=>t.setPlaceholder("YYYY-MM-DD").setValue(this.plugin.settings.dateFormat).onChange(async i=>{this.plugin.settings.dateFormat=i,await this.plugin.saveSettings()})),new k.Setting(e).setName("Default Timeline Range").setDesc("Number of months to display by default").addSlider(t=>t.setLimits(1,12,1).setValue(this.plugin.settings.defaultRangeMonths).setDynamicTooltip().onChange(async i=>{this.plugin.settings.defaultRangeMonths=i,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Tag Styles"}),e.createEl("p",{text:"Customize the appearance of timeline points based on the first hashtag in each task.",cls:"setting-item-description"}),this.displayTagStylesList(e),this.displayAddTagStyleForm(e),this.displayGroupingSettings(e)}displayGroupingSettings(e){e.createEl("h2",{text:"Points Grouping"}),e.createEl("p",{text:"Configure how timeline points are grouped when they appear close together. Grouping helps reduce visual clutter by combining nearby tasks into a single point with a count badge.",cls:"setting-item-description"}),new k.Setting(e).setName("Enable Grouping").setDesc("When enabled, tasks that appear close together on the timeline will be automatically grouped").addToggle(t=>t.setValue(this.plugin.settings.enableGrouping).onChange(async i=>{this.plugin.settings.enableGrouping=i,await this.plugin.saveSettings()})),new k.Setting(e).setName("Minimum Spacing").setDesc("Minimum distance (in pixels) between tasks before they are grouped together. Lower values create more groups.").addSlider(t=>t.setLimits(10,100,5).setValue(this.plugin.settings.minSpacingPixels).setDynamicTooltip().onChange(async i=>{this.plugin.settings.minSpacingPixels=i,await this.plugin.saveSettings()})),new k.Setting(e).setName("Maximum Group Span").setDesc("Maximum distance (in pixels) between the first and last task in a group. Prevents overly large groups.").addSlider(t=>t.setLimits(30,150,10).setValue(this.plugin.settings.maxGroupSpanPixels).setDynamicTooltip().onChange(async i=>{this.plugin.settings.maxGroupSpanPixels=i,await this.plugin.saveSettings()})),new k.Setting(e).addButton(t=>t.setButtonText("Reset to Defaults").setTooltip("Restore default grouping settings").onClick(async()=>{this.plugin.settings.enableGrouping=!0,this.plugin.settings.minSpacingPixels=25,this.plugin.settings.maxGroupSpanPixels=60,await this.plugin.saveSettings(),this.display()}))}displayTagStylesList(e){let t=e.createDiv({cls:"tag-styles-list"});if(this.plugin.settings.tagStyles.length===0){t.createEl("p",{text:"No tag styles configured yet. Add one below.",cls:"setting-item-description"});return}this.plugin.settings.tagStyles.forEach((i,s)=>{let n=t.createDiv({cls:"tag-style-preset"}),a=n.createDiv({cls:"tag-style-info"}),l=a.createDiv({cls:"tag-style-color-swatch"});l.style.backgroundColor=i.color,a.createSpan({cls:"tag-style-tag-name"}).setText(`#${i.tag}`),i.emoji&&a.createSpan({cls:"tag-style-emoji-preview"}).setText(i.emoji);let c=n.createDiv({cls:"tag-style-actions"});c.createEl("button",{text:"Edit",cls:"mod-cta"}).addEventListener("click",()=>{this.editTagStyle(s,i)}),c.createEl("button",{text:"Delete",cls:"mod-warning"}).addEventListener("click",async()=>{this.plugin.settings.tagStyles.splice(s,1),await this.plugin.saveSettings(),this.display()})})}displayAddTagStyleForm(e){e.createEl("h3",{text:"Add New Tag Style"});let t=e.createDiv({cls:"tag-style-form"}),i,s,n;new k.Setting(t).setName("Tag Name").setDesc("Enter tag name without the # symbol (e.g., 'log' for #log, or 'log/work' for #log/work)").addText(a=>{i=a.inputEl,a.setPlaceholder("log/work")}),new k.Setting(t).setName("Color").setDesc("Choose a color for the timeline point").addColorPicker(a=>{s=a.colorPickerEl,a.setValue("#3b82f6")}),new k.Setting(t).setName("Emoji (Optional)").setDesc("Enter an emoji to display below the timeline point").addText(a=>{n=a.inputEl,a.setPlaceholder("\u{1F4DD}")}),new k.Setting(t).addButton(a=>a.setButtonText("Add Style").setCta().onClick(async()=>{let l=i.value.trim().toLowerCase(),r=s.value,c=n.value.trim();if(!l){alert("Please enter a tag name");return}if(this.plugin.settings.tagStyles.some(m=>m.tag===l)){alert(`A style for tag "${l}" already exists`);return}this.plugin.settings.tagStyles.push({tag:l,color:r,emoji:c}),await this.plugin.saveSettings(),this.display()}))}editTagStyle(e,t){let{containerEl:i}=this;i.empty(),i.createEl("h2",{text:"Edit Tag Style"});let s=i.createDiv({cls:"tag-style-form"}),n,a,l;new k.Setting(s).setName("Tag Name").setDesc("Tag name without the # symbol").addText(r=>{n=r.inputEl,r.setValue(t.tag)}),new k.Setting(s).setName("Color").setDesc("Choose a color for the timeline point").addColorPicker(r=>{a=r.colorPickerEl,r.setValue(t.color)}),new k.Setting(s).setName("Emoji (Optional)").setDesc("Enter an emoji to display below the timeline point").addText(r=>{l=r.inputEl,r.setValue(t.emoji||"")}),new k.Setting(s).addButton(r=>r.setButtonText("Save").setCta().onClick(async()=>{let c=n.value.trim().toLowerCase(),m=a.value,d=l.value.trim();if(!c){alert("Please enter a tag name");return}let h=this.plugin.settings.tagStyles.findIndex(g=>g.tag===c);if(h!==-1&&h!==e){alert(`A style for tag "${c}" already exists`);return}this.plugin.settings.tagStyles[e]={tag:c,color:m,emoji:d},await this.plugin.saveSettings(),this.display()})).addButton(r=>r.setButtonText("Cancel").onClick(()=>{this.display()}))}};var j=class{constructor(o){v(this,"vault");this.vault=o}async getAvailableMonths(o,e){let t=new Set,i=this.vault.getMarkdownFiles();for(let s of i)if(this.isInDailyNotesFolder(s.path,o)){let n=this.extractDateFromFilename(s.name,e);if(n){let a=this.parseDate(n);if(a){let l=`${a.getFullYear()}-${a.getMonth()}`;t.add(l)}}}return Array.from(t).sort()}async parseDailyNotes(o,e,t,i){let s=new Map,n=this.vault.getMarkdownFiles();for(let r of n)if(this.isInDailyNotesFolder(r.path,o)){let c=this.extractDateFromFilename(r.name,e);if(c){let m=this.parseDate(c);if(m&&m>=t&&m<=i){let d=await this.extractTasks(r);s.set(c,{date:c,path:r.path,tasks:d})}}}let a=this.getAllDatesInRange(t,i),l=[];for(let r of a)s.has(r)?l.push(s.get(r)):l.push({date:r,path:"",tasks:[]});return l}getAllDatesInRange(o,e){let t=[],i=new Date(o);for(;i<=e;){let s=i.getFullYear(),n=String(i.getMonth()+1).padStart(2,"0"),a=String(i.getDate()).padStart(2,"0");t.push(`${s}-${n}-${a}`),i.setDate(i.getDate()+1)}return t}isInDailyNotesFolder(o,e){return e?o.startsWith(e):!0}extractDateFromFilename(o,e){let t=o.replace(/\.md$/,"");if(e==="YYYY-MM-DD"){let i=t.match(/(\d{4}-\d{2}-\d{2})/);return i?i[1]:null}return t}parseDate(o){try{let[e,t,i]=o.split("-").map(Number);return new Date(e,t-1,i)}catch(e){return null}}extractFirstTag(o){let e=/#([\p{L}\p{N}_/-]+)/u,t=o.match(e);return t?t[1].toLowerCase():void 0}hasImageAttachment(o){return/!\[\[.*?\.(png|jpg|jpeg|gif|webp|bmp|svg)\]\]|!\[.*?\]\(.*?\.(png|jpg|jpeg|gif|webp|bmp|svg)\)/i.test(o)}async extractTasks(o){let t=(await this.vault.cachedRead(o)).split(`
`),i=[],s=null,n=/^- \[([^\]]+)\]\s+\*(\d{2}:\d{2})(?:-(\d{2}:\d{2}))?\*\s+(.+)$/;for(let a=0;a<t.length;a++){let l=t[a],r=l.match(n);if(r){s&&(this.finalizeTask(s),i.push(s));let[,c,m,d,h]=r,[g,u]=m.split(":").map(Number),p=this.extractFirstTag(h),D=!!d,f,E;D&&d&&([f,E]=d.split(":").map(Number)),s={status:c,time:m,content:h.trim(),subItems:[],date:this.extractDateFromFilename(o.name,"YYYY-MM-DD")||"",hour:g,minute:u,firstTag:p,hasAttachment:!1,isTimeRange:D,timeEnd:d,endHour:f,endMinute:E}}else s&&l.trim().startsWith("-")&&l.includes("	")?s.subItems.push(l.trim().substring(1).trim()):s&&!l.trim().startsWith("-")&&l.trim()!==""&&s&&(this.finalizeTask(s),i.push(s),s=null)}return s&&(this.finalizeTask(s),i.push(s)),i}finalizeTask(o){if(o.hasAttachment=this.hasImageAttachment(o.content),!o.hasAttachment){for(let e of o.subItems)if(this.hasImageAttachment(e)){o.hasAttachment=!0;break}}}};var Y={dailyNotesFolder:"",dateFormat:"YYYY-MM-DD",defaultRangeMonths:1,tagStyles:[],enableGrouping:!0,minSpacingPixels:25,maxGroupSpanPixels:60,viewMode:"month",customStartDate:"",customEndDate:"",lastQuickRangePreset:"custom"};var I=class{parseConfig(o){let e=o.trim().split(`
`),t={};for(let i of e){let s=i.trim();if(!s||s.startsWith("#"))continue;let n=s.indexOf(":");if(n===-1)continue;let a=s.substring(0,n).trim(),l=s.substring(n+1).trim();switch(a){case"mode":if(l==="month"||l==="custom")t.mode=l;else return{error:`Invalid mode: "${l}". Must be "month" or "custom".`};break;case"startDate":t.startDate=l;break;case"endDate":t.endDate=l;break;case"show":if(t.show=this.parseQuickRangePreset(l),!t.show)return{error:`Invalid show preset: "${l}". Valid options: last-7, last-30, this-week, this-month, last-3m.`};break}}if(!t.mode)return{error:'Missing required parameter: "mode". Must specify "month" or "custom".'};if(t.mode==="month"&&t.startDate&&!this.parseDate(t.startDate))return{error:`Invalid startDate format: "${t.startDate}". Expected format: DD.MM.YYYY or YYYY-MM-DD.`};if(t.mode==="custom")if(t.show){if(t.startDate||t.endDate)return{error:'Cannot use "show" preset with explicit startDate/endDate. Use either "show" or explicit dates, not both.'}}else{if(!t.startDate||!t.endDate)return{error:'Custom mode requires either "show" preset or both "startDate" and "endDate".'};let i=this.parseDate(t.startDate),s=this.parseDate(t.endDate);if(!i)return{error:`Invalid startDate format: "${t.startDate}". Expected format: DD.MM.YYYY or YYYY-MM-DD.`};if(!s)return{error:`Invalid endDate format: "${t.endDate}". Expected format: DD.MM.YYYY or YYYY-MM-DD.`};if(s<i)return{error:`endDate (${t.endDate}) must be after or equal to startDate (${t.startDate}).`};let n=Math.ceil((s.getTime()-i.getTime())/(1e3*60*60*24));if(n>365)return{error:`Date range cannot exceed 365 days. Current range: ${n} days.`}}return t}parseQuickRangePreset(o){return{"last-7":"last7days","last-30":"last30days","this-week":"thisweek","this-month":"thismonth","last-3m":"last3months"}[o]||null}parseDate(o){if(o.includes(".")){let e=o.split(".");if(e.length===3){let t=parseInt(e[0],10),i=parseInt(e[1],10),s=parseInt(e[2],10);if(!isNaN(t)&&!isNaN(i)&&!isNaN(s))return new Date(s,i-1,t)}}else if(o.includes("-")){let e=o.split("-");if(e.length===3){let t=parseInt(e[0],10),i=parseInt(e[1],10),s=parseInt(e[2],10);if(!isNaN(t)&&!isNaN(i)&&!isNaN(s))return new Date(t,i-1,s)}}return null}calculateDateRange(o){if(o.mode==="month"){if(o.startDate){let a=this.parseDate(o.startDate);if(a){let l=new Date(a.getFullYear(),a.getMonth(),1),r=new Date(a.getFullYear(),a.getMonth()+1,0);return{startDate:l,endDate:r}}}let i=new Date,s=new Date(i.getFullYear(),i.getMonth(),1),n=new Date(i.getFullYear(),i.getMonth()+1,0);return{startDate:s,endDate:n}}if(o.show)return this.calculateQuickRangePreset(o.show);let e=this.parseDate(o.startDate),t=this.parseDate(o.endDate);return{startDate:e,endDate:t}}calculateQuickRangePreset(o){let e=new Date;e.setHours(0,0,0,0);let t,i;switch(o){case"last7days":i=new Date(e),t=new Date(e),t.setDate(t.getDate()-6);break;case"last30days":i=new Date(e),t=new Date(e),t.setDate(t.getDate()-29);break;case"thisweek":let s=e.getDay();t=new Date(e),t.setDate(t.getDate()-s),i=new Date(t),i.setDate(i.getDate()+6);break;case"thismonth":t=new Date(e.getFullYear(),e.getMonth(),1),i=new Date(e.getFullYear(),e.getMonth()+1,0);break;case"last3months":i=new Date(e),t=new Date(e),t.setMonth(t.getMonth()-3);break;default:t=new Date(e.getFullYear(),e.getMonth(),1),i=new Date(e.getFullYear(),e.getMonth()+1,0)}return{startDate:t,endDate:i}}};var S={MIN:.7,MAX:10,DEFAULT:1,STEP:.5,BASE_SEGMENT_WIDTH:200},R=class{constructor(o,e,t){v(this,"plugin");v(this,"container");v(this,"config");v(this,"initialStartDate");v(this,"initialEndDate");v(this,"currentStartDate");v(this,"currentEndDate");v(this,"zoomLevel",S.DEFAULT);v(this,"tooltips",[]);v(this,"timelineContainerEl",null);v(this,"isDragging",!1);v(this,"dragStartX",0);v(this,"dragStartScrollLeft",0);v(this,"zoomSlider",null);v(this,"zoomLabel",null);v(this,"configParser");v(this,"currentViewMode","custom");v(this,"monthSelectEl",null);v(this,"quickSelectEl",null);v(this,"customStartDateInputEl",null);v(this,"customEndDateInputEl",null);v(this,"viewModeContainerEl",null);this.plugin=o,this.container=e,this.config=t,this.configParser=new I;let i=this.configParser.calculateDateRange(t);this.initialStartDate=i.startDate,this.initialEndDate=i.endDate,this.currentStartDate=new Date(this.initialStartDate),this.currentEndDate=new Date(this.initialEndDate)}async render(){this.container.empty(),this.container.addClass("embedded-timeline-container"),await this.renderControls(),await this.renderTimeline()}destroy(){this.cleanupTooltips(),this.container.empty()}cleanupTooltips(){for(let o of this.tooltips)o.remove();this.tooltips=[]}async renderControls(){let o=this.container.createDiv({cls:"embedded-timeline-controls"}),e=o.createDiv({cls:"embedded-timeline-controls-row"}),t=o.createDiv({cls:"embedded-timeline-controls-row"}),i=e.createDiv({cls:"embedded-timeline-nav-group"});i.createEl("button",{text:"\u2190",cls:"mod-cta embedded-timeline-btn-compact",attr:{"aria-label":"Previous"}}).addEventListener("click",async()=>{await this.navigatePrevious()}),i.createEl("button",{text:"Today",cls:"mod-cta embedded-timeline-btn-compact"}).addEventListener("click",async()=>{await this.navigateToToday()}),i.createEl("button",{text:"\u2192",cls:"mod-cta embedded-timeline-btn-compact",attr:{"aria-label":"Next"}}).addEventListener("click",async()=>{await this.navigateNext()}),this.renderZoomControls(e),e.createEl("button",{text:"Reset",cls:"mod-warning embedded-timeline-btn-compact"}).addEventListener("click",async()=>{await this.resetToInitial()}),this.renderViewModeSelector(t)}formatDateDisplay(o){return o.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}formatDateForInput(o){let e=o.getFullYear(),t=String(o.getMonth()+1).padStart(2,"0"),i=String(o.getDate()).padStart(2,"0");return`${e}-${t}-${i}`}async renderViewModeSelector(o){let e=o.createDiv({cls:"embedded-timeline-view-mode"});this.viewModeContainerEl=e;let t=e.createEl("select",{cls:"embedded-timeline-select-compact"});t.createEl("option",{value:"month",text:"Month"}),t.createEl("option",{value:"custom",text:"Custom"}),t.value=this.currentViewMode,t.addEventListener("change",async()=>{this.currentViewMode=t.value,this.updateViewModeControls()});let s=e.createDiv({cls:"embedded-timeline-month-picker"}).createEl("select",{cls:"embedded-timeline-select-compact"});this.monthSelectEl=s,await this.populateMonthSelect(s),s.addEventListener("change",async()=>{let[d,h]=s.value.split("-").map(Number);this.currentStartDate=new Date(d,h,1),this.currentEndDate=new Date(d,h+1,0),this.zoomLevel=S.DEFAULT,await this.renderTimeline(),this.updateZoomSlider()});let n=e.createDiv({cls:"embedded-timeline-custom-picker"}),a=n.createEl("select",{cls:"embedded-timeline-select-compact"});this.quickSelectEl=a,a.createEl("option",{value:"custom",text:"Custom dates"}),a.createEl("option",{value:"last7days",text:"Last 7 days"}),a.createEl("option",{value:"last30days",text:"Last 30 days"}),a.createEl("option",{value:"thisweek",text:"This week"}),a.createEl("option",{value:"thismonth",text:"This month"}),a.createEl("option",{value:"last3months",text:"Last 3 months"}),a.value="custom",a.addEventListener("change",async()=>{let d=a.value;d!=="custom"&&this.applyQuickRangePreset(d)});let l=n.createDiv({cls:"embedded-timeline-date-pickers"}),r=l.createEl("input",{type:"date",cls:"embedded-timeline-date-input-compact"});this.customStartDateInputEl=r,r.value=this.formatDateForInput(this.currentStartDate);let c=l.createSpan({cls:"embedded-timeline-date-separator",text:"\u2014"}),m=l.createEl("input",{type:"date",cls:"embedded-timeline-date-input-compact"});this.customEndDateInputEl=m,m.value=this.formatDateForInput(this.currentEndDate),r.addEventListener("change",async()=>{await this.handleCustomDateChange()}),m.addEventListener("change",async()=>{await this.handleCustomDateChange()}),this.updateViewModeControls()}async handleCustomDateChange(){if(!this.customStartDateInputEl||!this.customEndDateInputEl)return;let o=this.customStartDateInputEl.value,e=this.customEndDateInputEl.value;if(!o||!e)return;let t=new Date(o),i=new Date(e);if(i<t){this.customStartDateInputEl.value=this.formatDateForInput(this.currentStartDate),this.customEndDateInputEl.value=this.formatDateForInput(this.currentEndDate);return}if(Math.ceil((i.getTime()-t.getTime())/(1e3*60*60*24))>365){this.customStartDateInputEl.value=this.formatDateForInput(this.currentStartDate),this.customEndDateInputEl.value=this.formatDateForInput(this.currentEndDate);return}this.currentStartDate=t,this.currentEndDate=i,this.quickSelectEl&&(this.quickSelectEl.value="custom"),this.zoomLevel=S.DEFAULT,await this.renderTimeline(),this.updateZoomSlider()}applyQuickRangePreset(o){let e=new Date;e.setHours(0,0,0,0);let t,i;switch(o){case"last7days":i=new Date(e),t=new Date(e),t.setDate(t.getDate()-6);break;case"last30days":i=new Date(e),t=new Date(e),t.setDate(t.getDate()-29);break;case"thisweek":let s=e.getDay();t=new Date(e),t.setDate(t.getDate()-s),i=new Date(t),i.setDate(i.getDate()+6);break;case"thismonth":t=new Date(e.getFullYear(),e.getMonth(),1),i=new Date(e.getFullYear(),e.getMonth()+1,0);break;case"last3months":i=new Date(e),t=new Date(e),t.setMonth(t.getMonth()-3);break;default:return}this.currentStartDate=t,this.currentEndDate=i,this.customStartDateInputEl&&this.customEndDateInputEl&&(this.customStartDateInputEl.value=this.formatDateForInput(t),this.customEndDateInputEl.value=this.formatDateForInput(i)),this.zoomLevel=S.DEFAULT,this.renderTimeline(),this.updateZoomSlider()}updateViewModeControls(){if(!this.monthSelectEl||!this.customStartDateInputEl||!this.customEndDateInputEl)return;let o=this.monthSelectEl.parentElement,e=this.customStartDateInputEl.parentElement;this.currentViewMode==="month"?(o&&(o.style.display="flex"),e&&(e.style.display="none")):(o&&(o.style.display="none"),e&&(e.style.display="flex"))}async populateMonthSelect(o){let e=await this.plugin.parser.getAvailableMonths(this.plugin.settings.dailyNotesFolder,this.plugin.settings.dateFormat);o.empty();for(let t of e){let[i,s]=t.split("-").map(Number),n=new Date(i,s,1),a=o.createEl("option");a.value=t,a.text=n.toLocaleDateString("en-US",{year:"numeric",month:"short"}),i===this.currentStartDate.getFullYear()&&s===this.currentStartDate.getMonth()&&(a.selected=!0)}}renderZoomControls(o){let e=o.createDiv({cls:"embedded-timeline-zoom-controls"}),t=e.createDiv({cls:"embedded-timeline-zoom-icon",attr:{"aria-label":"Zoom out"}});t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path><line x1="8" y1="11" x2="14" y2="11"></line></svg>',t.addEventListener("click",()=>{let a=Math.max(S.MIN,this.zoomLevel-S.STEP);this.applyZoom(a)});let i=e.createEl("input",{type:"range",cls:"embedded-timeline-zoom-slider"});i.min=String(S.MIN*100),i.max=String(S.MAX*100),i.value=String(this.zoomLevel*100),i.step=String(S.STEP*100);let s=e.createDiv({cls:"embedded-timeline-zoom-label"});s.setText(`${Math.round(this.zoomLevel*100)}%`);let n=e.createDiv({cls:"embedded-timeline-zoom-icon",attr:{"aria-label":"Zoom in"}});n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path><line x1="11" y1="8" x2="11" y2="14"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>',n.addEventListener("click",()=>{let a=Math.min(S.MAX,this.zoomLevel+S.STEP);this.applyZoom(a)}),i.addEventListener("input",()=>{let a=parseFloat(i.value)/100;s.setText(`${Math.round(a*100)}%`)}),i.addEventListener("change",()=>{let a=parseFloat(i.value)/100;this.applyZoom(a)}),this.zoomSlider=i,this.zoomLabel=s}updateZoomSlider(){this.zoomSlider&&(this.zoomSlider.value=String(this.zoomLevel*100)),this.zoomLabel&&this.zoomLabel.setText(`${Math.round(this.zoomLevel*100)}%`)}applyZoom(o,e){if(!this.timelineContainerEl)return;let t=this.timelineContainerEl,i=t.scrollLeft,s=t.clientWidth,n=t.scrollWidth,a;e!==void 0?a=i+e:a=i+s/2;let l=a/n;this.zoomLevel=o,this.updateZoomSlider(),this.renderTimeline().then(()=>{if(!this.timelineContainerEl)return;let r=this.timelineContainerEl.scrollWidth,c=l*r,m=e!==void 0?c-e:c-s/2;this.timelineContainerEl.scrollLeft=Math.max(0,m)})}getRangeDurationInDays(){let o=Math.abs(this.currentEndDate.getTime()-this.currentStartDate.getTime());return Math.ceil(o/(1e3*60*60*24))+1}async navigatePrevious(){let o=this.getRangeDurationInDays();this.currentStartDate.setDate(this.currentStartDate.getDate()-o),this.currentEndDate.setDate(this.currentEndDate.getDate()-o),this.zoomLevel=S.DEFAULT,await this.render()}async navigateNext(){let o=this.getRangeDurationInDays();this.currentStartDate.setDate(this.currentStartDate.getDate()+o),this.currentEndDate.setDate(this.currentEndDate.getDate()+o),this.zoomLevel=S.DEFAULT,await this.render()}async navigateToToday(){let o=new Date;this.currentStartDate=new Date(o.getFullYear(),o.getMonth(),1),this.currentEndDate=new Date(o.getFullYear(),o.getMonth()+1,0),this.zoomLevel=S.DEFAULT,await this.render()}async resetToInitial(){this.currentStartDate=new Date(this.initialStartDate),this.currentEndDate=new Date(this.initialEndDate),this.zoomLevel=S.DEFAULT,await this.render()}async renderTimeline(){this.cleanupTooltips();let o=this.container.querySelector(".embedded-timeline-scroll");o&&o.remove();let e=this.container.createDiv({cls:"embedded-timeline-scroll"}),t=await this.plugin.parser.parseDailyNotes(this.plugin.settings.dailyNotesFolder,this.plugin.settings.dateFormat,this.currentStartDate,this.currentEndDate);if(t.length===0){e.createDiv({cls:"timeline-empty",text:"No daily notes found in this date range"});return}await this.renderContinuousTimeline(e,t)}async renderContinuousTimeline(o,e){let t=o.createDiv({cls:"timeline-continuous"});this.timelineContainerEl=t,this.setupTimelineInteractions(t);let i=t.createDiv({cls:"timeline-track-continuous"}),s=S.BASE_SEGMENT_WIDTH*this.zoomLevel,n=s*e.length;i.style.width=`${n}px`;for(let a=0;a<e.length;a++){let l=e[a];await this.renderDaySegment(i,l,a,e.length,s)}}setupTimelineInteractions(o){o.addEventListener("wheel",i=>{if(i.ctrlKey||i.metaKey){i.preventDefault();let s=o.getBoundingClientRect(),n=i.clientX-s.left,l=-i.deltaY>0?S.STEP:-S.STEP,r=Math.max(S.MIN,Math.min(S.MAX,this.zoomLevel+l));this.applyZoom(r,n)}else i.preventDefault(),o.scrollLeft+=i.deltaY}),o.addEventListener("mousedown",i=>{if(i.button!==0)return;let s=i.target;s.closest(".timeline-task")||s.closest("a")||(i.preventDefault(),this.isDragging=!0,this.dragStartX=i.clientX,this.dragStartScrollLeft=o.scrollLeft,o.style.cursor="grabbing",o.style.userSelect="none")});let e=i=>{if(!this.isDragging||!this.timelineContainerEl)return;i.preventDefault();let s=i.clientX-this.dragStartX;this.timelineContainerEl.scrollLeft=this.dragStartScrollLeft-s},t=()=>{this.isDragging&&this.timelineContainerEl&&(this.isDragging=!1,this.timelineContainerEl.style.cursor="grab",this.timelineContainerEl.style.userSelect="")};document.addEventListener("mousemove",e),document.addEventListener("mouseup",t),o.addEventListener("mouseleave",()=>{this.isDragging&&this.timelineContainerEl&&(this.isDragging=!1,this.timelineContainerEl.style.cursor="grab",this.timelineContainerEl.style.userSelect="")})}groupOverlappingTasks(o,e){if(o.length===0)return[];if(!this.plugin.settings.enableGrouping)return o;let i=[...o.filter(r=>!r.isTimeRange)].sort((r,c)=>{let m=r.hour*60+r.minute,d=c.hour*60+c.minute;return m-d}),s=this.plugin.settings.minSpacingPixels,n=this.plugin.settings.maxGroupSpanPixels,a=[],l=[i[0]];for(let r=1;r<i.length;r++){let c=i[r-1],m=i[r],d=(c.hour*60+c.minute)/1440*100,h=(m.hour*60+m.minute)/1440*100,g=Math.abs(h-d)*(e/100),u=(l[0].hour*60+l[0].minute)/1440*100,p=Math.abs(h-u)*(e/100);if(g<s&&p<n)l.push(m);else{if(l.length>1){let D=l.reduce((w,L)=>w+(L.hour*60+L.minute),0)/l.length,f=D/1440*100,E=Math.floor(D/60),y=Math.floor(D%60);a.push({tasks:l,position:f,averageTime:`${String(E).padStart(2,"0")}:${String(y).padStart(2,"0")}`})}else a.push(l[0]);l=[m]}}if(l.length>1){let r=l.reduce((h,g)=>h+(g.hour*60+g.minute),0)/l.length,c=r/1440*100,m=Math.floor(r/60),d=Math.floor(r%60);a.push({tasks:l,position:c,averageTime:`${String(m).padStart(2,"0")}:${String(d).padStart(2,"0")}`})}else a.push(l[0]);return a}async renderDaySegment(o,e,t,i,s){let n=o.createDiv({cls:"timeline-segment"});n.style.width=`${s}px`,n.style.left=`${s*t}px`,e.tasks.length===0&&n.addClass("timeline-segment-empty");let a=new Date(e.date),l=n.createDiv({cls:"timeline-segment-date"});l.setText(a.toLocaleDateString("en-US",{month:"short",day:"numeric"})),e.path&&(l.addClass("timeline-segment-date-clickable"),l.addEventListener("click",async g=>{g.preventDefault();let u=this.plugin.app.vault.getAbstractFileByPath(e.path);u&&await this.plugin.app.workspace.getLeaf(!1).openFile(u)})),n.createDiv({cls:"timeline-segment-weekday"}).setText(a.toLocaleDateString("en-US",{weekday:"short"})),n.createDiv({cls:"timeline-segment-time timeline-segment-time-start"}).setText("00:00"),n.createDiv({cls:"timeline-segment-time timeline-segment-time-end"}).setText("23:59");let d=this.groupOverlappingTasks(e.tasks,s);for(let g of d)"tasks"in g?await this.renderGroupedTaskInSegment(n,g):await this.renderTaskInSegment(n,g);let h=x.detectOverlaps(e.tasks);for(let g of h)await this.renderTimeRangeInSegment(n,g)}getTagStyle(o){return o?this.plugin.settings.tagStyles.find(e=>e.tag===o):null}async renderGroupedTaskInSegment(o,e){let t=o.createDiv({cls:"timeline-task-dot-container timeline-task-grouped"}),i=Math.min(e.position,96);t.style.left=`${i}%`;let s=t.createDiv({cls:"timeline-task-dot"});s.setAttribute("data-status","grouped"),s.createDiv({cls:"timeline-task-count-badge"}).setText(String(e.tasks.length));let a=t.createDiv({cls:"timeline-emoji-stack"}),l=new Set;for(let m of e.tasks){let d=this.getTagStyle(m.firstTag);d&&d.emoji?l.add(d.emoji):m.hasAttachment&&!l.has("\u{1F4F8}")&&l.add("\u{1F4F8}")}l.forEach(m=>{a.createDiv({cls:"timeline-task-emoji"}).setText(m)});let r=document.body.createDiv({cls:"timeline-tooltip"});this.tooltips.push(r);let c=r.createDiv({cls:"timeline-tooltip-wrapper"});for(let m=0;m<e.tasks.length;m++){let d=e.tasks[m],h=c.createDiv({cls:"timeline-tooltip-content"});m>0&&h.addClass("timeline-tooltip-stacked");let g=h.createDiv({cls:"timeline-tooltip-time"}),u=this.getTagStyle(d.firstTag);u&&u.emoji&&g.createSpan({cls:"timeline-tooltip-time-emoji"}).setText(u.emoji),g.createSpan().setText(d.time);let D=h.createDiv({cls:"timeline-tooltip-task"});if(D.textContent=`[${d.status}] `,await this.renderTaskContent(D,d.content),d.subItems.length>0){let f=h.createEl("ul",{cls:"timeline-tooltip-subitems"});for(let E of d.subItems){let y=f.createEl("li");await this.renderTaskContent(y,E)}}}t.addEventListener("mouseenter",()=>{let m=t.getBoundingClientRect(),d=window.innerHeight,h=e.tasks.length*120,g=m.bottom+12,u=m.left+m.width/2,p="translateX(-50%)",D=!1;g+h>d-20&&d-g-20<200&&(g=m.top-Math.min(h,d*.6)-12,D=!0,g<20&&(g=20));let f=Math.min(d*.7,h);c.style.maxHeight=`${f}px`,D?r.addClass("tooltip-above"):r.removeClass("tooltip-above"),r.style.top=`${g}px`,r.style.left=`${u}px`,r.style.transform=p,r.addClass("is-visible"),t.addClass("is-hovered")}),t.addEventListener("mouseleave",()=>{r.removeClass("is-visible"),r.removeClass("tooltip-above"),t.removeClass("is-hovered")}),r.addEventListener("mouseenter",()=>{r.addClass("is-visible"),t.addClass("is-hovered")}),r.addEventListener("mouseleave",()=>{r.removeClass("is-visible"),r.removeClass("tooltip-above"),t.removeClass("is-hovered")})}async renderTaskInSegment(o,e){let i=(e.hour*60+e.minute)/1440*100;i=Math.min(i,96);let s=o.createDiv({cls:"timeline-task-dot-container"});s.style.left=`${i}%`;let n=s.createDiv({cls:"timeline-task-dot"});n.setAttribute("data-status",e.status);let a=this.getTagStyle(e.firstTag);a&&a.color&&(n.addClass("timeline-task-dot-custom"),n.style.setProperty("background-color",a.color,"important")),n.createDiv({cls:"timeline-task-label"}).setText(e.time);let r=s.createDiv({cls:"timeline-emoji-stack"});a&&a.emoji?r.createDiv({cls:"timeline-task-emoji"}).setText(a.emoji):e.hasAttachment&&r.createDiv({cls:"timeline-task-emoji"}).setText("\u{1F4F8}");let c=document.body.createDiv({cls:"timeline-tooltip"});this.tooltips.push(c);let m=c.createDiv({cls:"timeline-tooltip-content"}),d=m.createDiv({cls:"timeline-tooltip-time"});a&&a.emoji&&d.createSpan({cls:"timeline-tooltip-time-emoji"}).setText(a.emoji),d.createSpan().setText(e.time);let g=m.createDiv({cls:"timeline-tooltip-task"});if(g.textContent=`[${e.status}] `,await this.renderTaskContent(g,e.content),e.subItems.length>0){let u=m.createEl("ul",{cls:"timeline-tooltip-subitems"});for(let p of e.subItems){let D=u.createEl("li");await this.renderTaskContent(D,p)}}s.addEventListener("mouseenter",()=>{let u=s.getBoundingClientRect(),p=window.innerHeight,D=u.bottom+12;setTimeout(()=>{let f=c.offsetHeight;D+f>p-20?(D=u.top-f-12,c.addClass("tooltip-above"),D<20&&(D=20)):c.removeClass("tooltip-above"),c.style.top=`${D}px`},0),c.style.top=`${D}px`,c.style.left=`${u.left+u.width/2}px`,c.style.transform="translateX(-50%)",c.addClass("is-visible"),s.addClass("is-hovered")}),s.addEventListener("mouseleave",()=>{c.removeClass("is-visible"),c.removeClass("tooltip-above"),s.removeClass("is-hovered")}),c.addEventListener("mouseenter",()=>{c.addClass("is-visible"),s.addClass("is-hovered")}),c.addEventListener("mouseleave",()=>{c.removeClass("is-visible"),c.removeClass("tooltip-above"),s.removeClass("is-hovered")})}async renderTimeRangeInSegment(o,e){let t=e.task;if(!t.endHour||t.endMinute===void 0)return;let i=t.hour*60+t.minute,s=t.endHour*60+t.endMinute,n=Math.min(i/1440*100,96),l=Math.min(s/1440*100,100)-n,r=o.createDiv({cls:"timeline-range-container"});r.style.left=`${n}%`,r.style.width=`${l}%`;let c=e.overlapLevel===0?0:e.overlapLevel*40;r.style.bottom=`calc(50% + ${c}px)`,r.setAttribute("data-overlap-level",String(e.overlapLevel));let m=r.createDiv({cls:"timeline-range-line"});m.setAttribute("data-status",t.status);let d=this.getTagStyle(t.firstTag);d&&d.color&&(m.addClass("timeline-range-line-custom"),m.style.setProperty("background-color",d.color,"important")),m.createDiv({cls:"timeline-range-label"}).setText(`${t.time} - ${t.timeEnd}`);let g=r.createDiv({cls:"timeline-range-emoji"});d&&d.emoji?g.createDiv({cls:"timeline-task-emoji"}).setText(d.emoji):t.hasAttachment&&g.createDiv({cls:"timeline-task-emoji"}).setText("\u{1F4F8}");let u=document.body.createDiv({cls:"timeline-tooltip"});this.tooltips.push(u);let p=u.createDiv({cls:"timeline-tooltip-content"}),D=p.createDiv({cls:"timeline-tooltip-time"});d&&d.emoji&&D.createSpan({cls:"timeline-tooltip-time-emoji"}).setText(d.emoji),D.createSpan().setText(`${t.time} - ${t.timeEnd}`);let E=p.createDiv({cls:"timeline-tooltip-task"});if(E.textContent=`[${t.status}] `,await this.renderTaskContent(E,t.content),t.subItems.length>0){let y=p.createEl("ul",{cls:"timeline-tooltip-subitems"});for(let w of t.subItems){let L=y.createEl("li");await this.renderTaskContent(L,w)}}r.addEventListener("mouseenter",()=>{let y=r.getBoundingClientRect(),w=window.innerHeight,L=y.bottom+12;setTimeout(()=>{let M=u.offsetHeight;L+M>w-20?(L=y.top-M-12,u.addClass("tooltip-above"),L<20&&(L=20)):u.removeClass("tooltip-above"),u.style.top=`${L}px`},0),u.style.top=`${L}px`,u.style.left=`${y.left+y.width/2}px`,u.style.transform="translateX(-50%)",u.addClass("is-visible"),r.addClass("is-hovered")}),r.addEventListener("mouseleave",()=>{u.removeClass("is-visible"),u.removeClass("tooltip-above"),r.removeClass("is-hovered")}),u.addEventListener("mouseenter",()=>{u.addClass("is-visible"),r.addClass("is-hovered")}),u.addEventListener("mouseleave",()=>{u.removeClass("is-visible"),u.removeClass("tooltip-above"),r.removeClass("is-hovered")})}async renderTaskContent(o,e){let t=/(!\[\[([^\]]+)\]\])|(\[\[([^\]]+)\]\])/g,i=0,s;for(;(s=t.exec(e))!==null;){if(s.index>i&&await this.renderTextWithLinks(o,e.substring(i,s.index)),s[1]){let n=s[2];await this.renderImage(o,n)}else if(s[3]){let n=s[4];this.renderLink(o,n)}i=s.index+s[0].length}i<e.length&&await this.renderTextWithLinks(o,e.substring(i))}async renderTextWithLinks(o,e){let t=/#([\p{L}\p{N}_\/-]+)/gu,i=0,s;for(;(s=t.exec(e))!==null;){if(s.index>i){let l=o.createSpan();l.textContent=e.substring(i,s.index)}let n=s[1],a=o.createEl("a",{cls:"tag timeline-tooltip-tag",href:"#"});a.textContent=`#${n}`,a.addEventListener("click",async l=>{var r;l.preventDefault(),(r=this.plugin.app.internalPlugins.getPluginById("global-search"))==null||r.instance.openGlobalSearch(`tag:#${n}`)}),i=s.index+s[0].length}if(i<e.length){let n=o.createSpan();n.textContent=e.substring(i)}}renderLink(o,e){let t=e.split("|"),i=t[0].trim(),s=t.length>1?t[1].trim():i,n=o.createEl("a",{cls:"internal-link timeline-tooltip-link",href:"#"});n.textContent=s,n.addEventListener("click",async a=>{a.preventDefault();let l=this.plugin.app.metadataCache.getFirstLinkpathDest(i,"");l&&await this.plugin.app.workspace.getLeaf(!1).openFile(l)})}async renderImage(o,e){let t=this.plugin.app.vault.getAbstractFileByPath(e);if(t&&t instanceof this.plugin.app.vault.adapter.constructor){let s=o.createDiv({cls:"timeline-tooltip-image"}).createEl("img"),n=this.plugin.app.vault.getResourcePath(t);s.src=n,s.alt=e}else{let s=this.plugin.app.vault.getFiles().find(n=>n.name===e||n.path.endsWith(e));if(s){let a=o.createDiv({cls:"timeline-tooltip-image"}).createEl("img"),l=this.plugin.app.vault.getResourcePath(s);a.src=l,a.alt=e}}}};var N=class extends z.Plugin{constructor(){super(...arguments);v(this,"settings");v(this,"parser");v(this,"embeddedTimelines",new Map)}async onload(){await this.loadSettings(),this.parser=new j(this.app.vault),this.registerView(C,e=>new F(e,this)),this.addRibbonIcon("calendar-clock","Open Daily Notes Timeline",()=>{this.activateView()}),this.addCommand({id:"open-timeline-view",name:"Open Daily Notes Timeline",callback:()=>{this.activateView()}}),this.addSettingTab(new H(this.app,this)),this.registerMarkdownCodeBlockProcessor("daily-timeline",this.processTimelineCodeblock.bind(this))}async processTimelineCodeblock(e,t,i){let n=new I().parseConfig(e);if("error"in n){t.createDiv({cls:"embedded-timeline-error",text:`\u26A0\uFE0F Timeline Configuration Error: ${n.error}`});return}let a=this.embeddedTimelines.get(t);a&&(a.destroy(),this.embeddedTimelines.delete(t));let l=new R(this,t,n);this.embeddedTimelines.set(t,l);try{await l.render()}catch(r){t.createDiv({cls:"embedded-timeline-error",text:`\u26A0\uFE0F Failed to render timeline: ${r.message}`})}}async activateView(){let{workspace:e}=this.app,t=e.getLeavesOfType(C)[0];t||(t=e.getLeaf(!0),await t.setViewState({type:C,active:!0})),e.revealLeaf(t)}async loadSettings(){this.settings=Object.assign({},Y,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}onunload(){this.app.workspace.detachLeavesOfType(C);for(let e of this.embeddedTimelines.values())e.destroy();this.embeddedTimelines.clear()}};
